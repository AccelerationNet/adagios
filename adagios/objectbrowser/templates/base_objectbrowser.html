{% extends "base2.html" %}
{% block title %}Objectbrowser{% endblock %}


{% block adagios_hausinn %}
    <ul class="breadcrumb">
        <li>
            <a href="{{ BASE_URL }}">Home</a> <span class="divider">/</span>
        </li>
        <li>
            {% block nav1 %}
                <a href="{{ BASE_URL }}/objectbrowser/">objectbrowser</a>
            {% endblock %}
            <span class="divider">/</span>
        </li>
    </ul>
    <h2>
        <i class="icon-th-large"></i> <small>{% block smallheader %}block=smallheader{% endblock%} </small> {% block largeheader %}block=largeheader{% endblock %}
    </h2>
{% endblock %}


{% block sidebar %}
    <h5>Actions</h5>
    <ul class="nav nav-list">

        <li><a data-toggle="modal" href="#geek_edit"><i class="icon-pencil"></i> Geek Edit</a></li>

        {% if my_object.object_type == 'service' %}
        <li>
            <a href="{{ nagios_url }}/cgi-bin/extinfo.cgi?type=2&host={{  my_object.host_name }}&service={{  my_object.service_description }}">
                <i class="icon-fire"></i> Open in Nagios</a>
        </li>
        {% endif %}

        {% if my_object.object_type == 'host' %}
            <li>
                <a href="{{ nagios_url }}/cgi-bin/extinfo.cgi?type=2&host={{  my_object.host_name }}">
                    <i class="icon-fire"></i> Open in Nagios</a>
            </li>
        {% endif %}

        <li><a href="{{ my_object.action_url }}"><i class="glyph-charts"></i> View Graphs</a></li>

    </ul>

    <h5>Diagnostics</h5>
    <ul class="nav nav-list">
        {% if command_line and form.host_name.value and form.register != '0' %}
            <li><a data-toggle="modal" href="#run_check_plugin"><i class="icon-play"></i> Run Check Plugin</a></li>
        {% endif %}
    </ul>
    <hr/>
    {% if effective_parents %}
        <h5>Parents</h5>
        <ul class="nav nav-list">
            {% for i in effective_parents %}
                <li><a href="{% url edit_object i.id %}">{{ i.name }}</a></li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if effective_services %}
        <h5>Related services</h5>
        <ul class="nav nav-list">
        {% for i in effective_services %}
         <li><a href="{% url edit_object i.id %}">{{ i.service_description }}</a></li>
        {% endfor %}
        </ul>
    {% endif %}

    {% if effective_contactgroups %}
        <h5>Contactgroups</h5>
        <ul class="nav nav-list">
            {% for i in effective_contactgroups %}
                <li><a href="{% url edit_object i.id %}">{{ i.shortname }}</a></li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if effective_hostgroups %}
        <h5>Hostgroups</h5>
        <ul class="nav nav-list">
            {% for i in effective_hostgroups %}
                <li><a href="{% url edit_object i.id %}">{{ i.shortname }}</a></li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if effective_hosts %}
        <h5>Hosts</h5>
        <ul class="nav nav-list">
            {% for i in effective_hosts %}
                <li><a href="{% url edit_object i.id %}">{{ i.shortname }}</a></li>
            {% endfor %}
        </ul>
    {% endif %}
    {% if effective_contacts %}
        <h5>Contacts</h5>
        <ul class="nav nav-list">
            {% for i in effective_contacts %}
                <li><a href="{% url edit_object i.id %}">{{ i.shortname }}</a></li>
            {% endfor %}
        </ul>
    {% endif %}

    <div class="modal hide fade" id="run_check_plugin" data-object-id="{{ my_object.id }}">
        <div class="modal-header">
            <h3>Run Check Plugin</h3>
            <div class="well">{{ command_line }}</div>
            <div class="row">
                <div class="span2">Status:</div>
                <div class="span2 label" id="pluginstate">Pending</div>
            </div>
            <div class="row">
                <div class="span2">Plugin Output:</div>
            </div>
        </div>
        <div class="modal-body">
            <div class="row">
                <div class="span8" style="height: 250px">
                    <pre id="pluginoutput">Executing check plugin</pre>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="run_check_plugin_refresh" class="btn hide" data-object-id="{{ my_object.id }}"><i class="icon-refresh"></i> Refresh</button>
            <button class="btn" data-dismiss="modal">Close</button>
        </div>
    </div>
    <div class="modal hide fade" id="geek_edit">
        <form action="geek_edit/id={{my_object.id}}" method="post">{% csrf_token %}
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">Ã—</button>
                <h3>Geek Edit</h3>
            </div>
            <div class="modal-body">
                <p>
                <fieldset id="id_geek_edit" class="objectbrowser_geek_edit">
                    {{ geek_edit }}
                </fieldset>
                <strong>Filename:</strong> {{ my_object.filename }}
            </div>
            <div class="modal-footer">
                <button class="btn" data-dismiss="modal">Close</button>
                <button class="btn btn-primary" type="submit">Save changes</button>
            </div>
        </form>
    </div>
{% endblock %}


{% block footer %}
    <script src="{{ MEDIA_URL }}chosen/chosen.jquery.js" type="text/javascript"></script>
    <script type="text/javascript" xmlns="http://www.w3.org/1999/html">

        $('#objecttab a:first').tab('show');
        $(document).ready(function() {



            $("[rel=tooltip]").popover();
            $("#popover").popover();
            $('#general select').chosen();
            $('#notifications select').chosen();
            $('#monitoring select').chosen();

        });
        function run_check_command() {
            $.getJSON("/rest/pynag/json/run_check_command",
                    {
                        object_id: '{{my_object.id}}'
                    },
                    function(data) {
                        var statusLabel = 'label-inverse';
                        var statusString = 'Unknown';
                        if (data[0] == 2) {
                            statusLabel = 'label-important';
                            statusString = 'Critical';
                        }
                        if (data[0] == 1) {
                            statusLabel = 'label-warning';
                            statusString = 'Warning';
                        }
                        if (data[0] == 0) {
                            statusLabel = 'label-success';
                            statusString = 'OK';
                        }
                        $('#run_check_plugin div.modal-body').html('<div class="row"><span class="span2">Status:</span><span class="span2 label ' + statusLabel + '">' + statusString + '</span></div><div class="row"><span class="span2">Plugin Output:</span><span class="span2">' + data[1] + '</span></div>');
                        $('#run_check_plugin_refresh').show();
                    }

            );
        }
        $('#run_check_plugin_refresh').click(function() {
            $('#run_check_plugin div.modal-body').html('Rerunning plugin');
            run_check_command();
            return false;
        });
        $('#run_check_plugin').on('show', function () {
            run_check_command();
        });
    </script>
{%  endblock %}
