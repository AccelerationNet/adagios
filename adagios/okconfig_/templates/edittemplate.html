{% extends "base_okconfig.html" %}
{% block title %}Edit Host{% endblock %}
{% block smallheader %}Edit{% endblock %}
{% block largeheader %}Host{% endblock %}



{% block content %}
{% if myhost %}
    <div>
    <h3>{{ host_name }} information:</h3>
        <dl class="dl-horizontal">
            <dt>Host Name</dt>
            <dd>{{ myhost.host_name }}</dd>
            <dt>Address</dt>
            <dd>{{ myhost.address }}</dd>
            <dt>Status</dt>
            <dd><span id="host_status" class="label">Pending</span> </dd>
        </dl>
    </div>


    <!-- <button class="btn btn-success">Run all Service checks</button> -->
    <div style="margin: 16px">
        <a href="{% url okconfig_.views.install_agent %}/?remote_host={{ myhost.host_name }}" class="btn btn-success">Install Agent</a>
        <a href="{% url okconfig_.views.addtemplate %}/?host_name={{ myhost.host_name }}" class="btn btn-success">Add templates</a>
    </div>

    <h3>Services of this host:</h3>
    <hr>
    <form action="#" method="post" class="form-horizontal">{% csrf_token %}
        <table class="table">
        {% for form in forms %}
                <tr class="alert-info">
                    <th >
                        {% for field in form %}
                            {% if field.label == "register" %}
                            {{ field }}
                            {% for err in field.errors %}
                                <p class="help-inline error">{{ err }}</p>
                            {% endfor %}
                            {% endif %}
                        {% endfor %}
                    </th>
                    <th colspan=2>{{ form.description }}
                        <span id="{{ form.service.id }}_status" class="label pull-right service_status run_check_command">Pending</span>
                        {% if fields.non_field_errors %}
                            <div class="alert alert-warning">{{ fields.non_field_errors  }}</div>
                        {%  endif %}
                    </th>
                </tr>

                {% for field in form %}
                    {% if field.label == "register" %}
                    {% else %}
                        <tr style="padding:0px; font-size:11px">
                            <td></td>
                            <td style="margin:0;" >
                                {{ field.label }}
                            </td>
                            <td width="80%" style="padding:0; height:12px; line-height:12px;">
                                {{ field }}
                                {% for err in field.errors %}
                                    <p class="help-inline error">{{ err }}</p>
                                {% endfor %}

                            </td>
                        </tr>
                   {% endif %}
                {% endfor %}
                <tr>
                    <td colspan=3>
                        <code>{{ form.command_line }}</code>
                    </td>
                </tr>
                <tr>
                    <td colspan=3>
                        <button class="pull-right btn" type="submit">Save</button>
                    </td>
                </tr>

        {% endfor %}
        </table>

    </form>
{% else %}
    Host not found.
{% endif %}

{% endblock %}

{% block footer %}
    {{ block.super }}
    <script>
    $(document).ready(function() {
        {% if myhost %}
        $.getJSON('{% url rest/pynag %}json/run_check_command',
                { object_id: '{{ myhost.id }}' },
                function(data) {
                    var host_status = $('span#host_status');
                    var host_status_output = $('span#host_status_output');
                    host_status_output.text(data[1]);
                    host_status.addClass('label-success');
                    if (data[0] == '0') {
                        host_status.text('OK');
                        host_status.addClass('label-success');
                    }
                    if (data[0] == '1') {
                        host_status.text('Warning');
                        host_status.addClass('label-warning');
                    }
                    if (data[0] == '2') {
                        host_status.text('Critical');
                        host_status.addClass('label-danger');
                    }
                }).error(function(jqXHR) {
                    /* TODO - fix this to a this style */
                    //alert('Failed to fetch data: URL: "' + this.url + '" Server Status: "' + jqXHR.status + '" Status: "' + jqXHR.statusText + '"');
                });
        {% endif %}
    });
    //$(".collapse").collapse()
    </script>
{% endblock %}