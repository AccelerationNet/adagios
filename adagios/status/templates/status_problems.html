{% extends "base1.html" %}

{% load adagiostags %}
{% block title %}Problems{% endblock %}
{% block titlebar %} {% endblock %}
{% block maincontent %}
    <h2>Unhandled Problems</h2>
    <table class="table  table-condensed" style="white-space: nowrap;" xmlns="http://www.w3.org/1999/html"
           xmlns="http://www.w3.org/1999/html">

    {% if network_problems %}

        {% for i in network_problems %}
            <tr style="color: black;">
                <td></td>
                <td>{{ i.name }}</td>
                <td><div class="circle circle-spin state_2"></div><b> Network Outage</b></td>
                <td>
                    {{ i.plugin_output }}
                </td>
                <td>
                    {{ i.last_state_change|timestamp|timesince }}
                </td>

            </tr>
        {% endfor %}

    {% endif %}
    {% if host_problems %}
        <tr><td colspan="5"></td></tr>

        <!--
        <tr>
            <th style="width: 20px; max-width: 20px;"></th>
            <th>Host Name</th>
            <th></th>
            <th>Description</th>
        </tr>
        -->
        {% for i in host_problems %}
            <tr  style="color: black;">
                <td></td>
                <td>{{ i.name }}</td>
                <td><b><div class="circle  state_2"></div> Host down</b></td>
                <td>
                    {{ i.plugin_output }}
                </td>
                <td>
                    {{ i.last_state_change|timestamp|timesince }}
                </td>
            </tr>
        {% endfor %}
    {% endif %}

    {% if service_problems %}
        <tr><td colspan="5"></td></tr>

        <!--
        <tr>
            <th style="width: 20px; max-width: 20px;"></th>
            <th>Host Name</th>
            <th>Service</th>
            <th>Description</th>
        </tr>
        -->
        {% for i in service_problems %}
            <tr>
                <td></td>
                <td>{{ i.host_name }}</td>
                <td >
                    <div class="circle  state_{{ i.state }} circle_unhandled"></div> <b>{{ i.description }}</b>
                </td>
                <td>
                    {{ i.plugin_output }}
                </td>
                <td>
                    {{ i.last_state_change|timestamp|timesince }}
                </td>
            </tr>
        {% endfor %}
    {% endif %}
</table>

{% if log %}
    <h3>Last {{ log|length }} alerts:</h3>
    <table style="font-size: 80%;" class="table table-condensed">
        {% for line in log %}
                <tr>
                    <td width=20px style="white-space: nowrap;">{{ line.time|timestamp|date:'Y-m-d H:i' }} </td>
                    <td width=20px><div>{{ line.host_name }}</div></td>
                    <td width=200px><div>{{ line.service_description }}</div></td>
                    <td width="20px"><div class="circle state_{{ line.state }}"></div></td>
                    <td>
                        <div>{{ line.plugin_output }}</div></td>
                </tr>
        {% endfor %}
    </table>
{% endif %}
{% endblock %}