{% extends "base_status.html" %}
{% load adagiostags %}

{% block title %}{{ my_object.display_name }}{% endblock %}
{% block smallheader %}{{ host.display_name }} {% endblock %}
{% block largeheader %}
    <span class="state_{{ my_object.state }}">{{ service.display_name }} is {{ my_object.status }}</span>
{% endblock %}
{% block nav1 %}{{ block.super }}{% endblock %}

{% block adagios_hausinn %}{{ block.super }}{% endblock %}

{% block content %}
    <ul class="nav nav-tabs" id="objecttab">
        <li><a href="#general" data-toggle="tab">General</a></li>
        <li><a href="#information" data-toggle="tab">Information</a></li>
        <li><a href="#events" data-toggle="tab">History</a></li>
        <li><a href="#graphs" data-toggle="tab">Graphs</a></li>
        <li><a href="#custom_variables" data-toggle="tab">Custom Variables</a></li>
        <li><a href="#other" data-toggle="tab">Misc</a></li>
    </ul>
    <div class="tab-content">

    <div class="tab-pane" id="general">
    {% if my_object %}
                <table class="table">
                    <tr >
                        <td></td>
                        <td>Host Name</td>
                        <td><a href="{% url status.views.status_detail host.name %}">{{ host.display_name }}</a></td>
                    </tr>
                    <tr >
                        <td></td>
                        <td>Host Address</td>
                        <td>{{ host.address }}</td>
                    </tr>
                    {% if service %}
                    <tr >
                        <td></td>
                        <td>Service Name</td>
                        <td>{{ service.display_name }}</td>
                    </tr>
                    {% endif %}

                    <tr>
                        <td style="width: 20px;"></td>
                        <td>Check output</td>
                        <td>
                            {% if my_object.long_plugin_output %}
                            <pre>{{ my_object.plugin_output }}
{{ my_object.long_plugin_output }}</pre>
                            {% else %}
                            <pre>{{ my_object.plugin_output }}</pre>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>Performance  Data</td>
                        <td >
                            {% if perfdata %}
                                <table border=1 class=table style="border-color: #ffffff;" >
                                    <tr>
                                        <th>label</th>
                                        <th>value</th>
                                        <th>warn</th>
                                        <th>crit</th>
                                        <th>unit</th>
                                        <th>min</th>
                                        <th>max</th>
                                        <th>status</th>
                                        <th>pnp</th>
                                    </tr>
                                    {% for i in perfdata %}
                                        <tr class="state_{{ i.get_status }}">
                                            <td>{{ i.label }}</td>
                                            <td>{{ i.value }} </td>
                                            <td>{{ i.warn }}  </td>
                                            <td>{{ i.crit }}  </td>
                                            <td> {{ i.uom }}</td>
                                            <td>{{ i.min }}   </td>
                                            <td>{{ i.max }}   </td>
                                            <td><label >{{ i.status }}</label></td>
                                            <td>
                                                <a href="{% url pnp.views.pnp %}/image?host={{ host.name }}&source={{ i.i }}&srv={% if my_object.object_type == 'service' %}{{ service.description }}{% else %}_HOST_{% endif %}" class="preview" title="pnp4nagios graph"><i class="glyph glyph-charts"></i></a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </table>
                            {% else %}
                                No Perfdata available.
                            {% endif %}

                        </td>
                    </tr>


                </table>
    {% endif %}
    </div>

    <div class="tab-pane" id="other">
        <h4>Information available via livestatus</h4>:
        <table class=table>
            {% for k,v in my_object.items %}
            <tr>
                <td>                {{ k }}
                </td>
                <td>
                {{ v }}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div class="tab-pane" id="information">
        <table class="table">
            <tr>
                <td>External Links </td>
                <td>
                    {% if my_object.notes_url_expanded %}
                        <a href="{{ my_object.notes_url_expanded }}">notes</a>
                    {% endif %}
                    {% if my_object.action_url_expanded %}
                        <a href="{{ my_object.action_url_expanded }}">actions</a>
                    {% endif %}
            </tr>
            <tr></tr>
            <tr>
                <td>
                <label for="id_notes">Notes</label>
                </td>
                <td><textarea id="id_notes" cols="100" rows=3 name="notes">{{ my_object.notes }}</textarea></td>
            </tr>
            <tr>
                <td>
                    Comments:
                </td>
                <td>
                    <table>
                        <tr>
                            <th>Actions</th>
                            <th>Author</th>
                            <th>Message</th>
                        </tr>
                        {% for i in comments_with_info %}
                        <td></td>
                        <td>{{ i.1 }}</td>
                        <td>{{ i.2 }}</td>
                    {% endfor %}
                    </table>
                </td>
            </tr>
        </table>
        <hr>
        This check is executed every <a href="#">{{ my_object.check_interval }}</a> minutes.

        When a problem occurs it will check <a href="#">{{ my_object.max_check_attempts }}</a> times

        every <a href="#">{{ my_object.retry_interval }}</a> minutes before going to
        hard state and start sending out notifications.
        <table class=table>
            <tr>
                <td>Last Check</td>
                <td>
                    {{ my_object.last_check|timestamp|date:'Y-m-d H:i' }}
                     ({{ my_object.last_check|timestamp|timesince  }} ago)
                </td>
            </tr>
            <tr>
                <td>Next Check</td>
                <td>
                    {{ my_object.next_check|timestamp|date:'Y-m-d H:i' }}
                    ({{ my_object.next_check|timestamp|timeuntil }})
                    <a href="#"><i class="glyph-refresh" title="Reschedule this check to run right now"></i></a>
                </td>
            </tr>
            <tr>
                <td>Check Period</td>
                <td>
                    {% if my_object.check_period %}
                    <a href="{% url edit_by_shortname "timeperiod" my_object.check_period %}">{{ my_object.check_period }}</a></td>
                    {% else %}
                    Unknown
                    {% endif %}
            </tr>
            <tr>
                <td>Notification Period</td>
                <td><a href="{% url edit_by_shortname "timeperiod" my_object.notification_period %}">{{ my_object.notification_period }}</a></td>
            </tr>
        </table>
    </div>

    <div class="tab-pane" id="custom_variables">
        Some checks have custom variables defined. These can be defined for example to define warning/critical thresholds
        for custom plugins.
        <p></p>
        {% if my_object.custom_variables %}
        <table class="table">
            <tr>
                <th>
                    Variable Name
                </th>
                <th>
                    Value
                </th>
            </tr>
            {% for k,v in my_object.custom_variables.items %}
                <tr>
                <td>{{ k }}</td>
                <td>
                    <input name="{{ k }}" value="{{ v }}"/>
                </td>
                </tr>
            {% endfor %}
        </table>
        {% else %}
        This check has no custom variables defined.
        {% endif %}
    </div>
        <div class="tab-pane" id="events">
            Last {{ log|length }} log entries:
            <table style="font-size: 80%;" class=table>
                {% for line in log %}
                    {% ifchanged line.time|timestamp|date:"Y-m-d" %}
                    <tr><td></td></tr>
                    {% endifchanged %}
                    <tr class="state_{{ line.state }}">
                    <td>{{ line.time|timestamp|date:'Y-m-d H:i' }} </td>
                    <td><div>{{ line.type }}</div></td>
                    <td>
                        <div>{{ line.options }}</div></td>
                    </tr>
                {% endfor %}
            </table>
        </div>


        <div class="tab-pane" id="graphs">
                {% if graph_urls %}
                    <div style="padding-left: 200px;" class="tabbable"> <!-- Only required for left/right tabs -->
                        <ul class="nav nav-pills">
                            <li><a href="#hours" data-toggle="tab">4 Hours</a></li>
                            <li class="active"><a href="#day" data-toggle="tab">25 Hours</a></li>
                            <li><a href="#week" data-toggle="tab">One Week</a></li>
                            <li><a href="#month" data-toggle="tab">One Month</a></li>
                            <li><a href="#year" data-toggle="tab">One Year</a></li>
                        </ul>

                    <div class="tab-content">
                        <div class="tab-pane" id="hours">
                            {% for graph in graph_urls %}
                                    {% if graph.title == "4 Hours" %}
                                        <img src="{% url pnp.views.pnp 'image' %}?{{ graph.image_url }}&graph_width=320">
                                    {% endif %}
                            {% endfor %}
                        </div>

                        <div class="tab-pane active" id="day">
                            {% for graph in graph_urls %}
                                {% if graph.title == "25 Hours" %}
                                    <img src="{% url pnp.views.pnp 'image' %}?{{ graph.image_url }}&graph_width=320">
                                {% endif %}
                            {% endfor %}
                        </div>

                        <div class="tab-pane" id="week">
                            {% for graph in graph_urls %}
                                {% if graph.title == "One Week" %}
                                    <img src="{% url pnp.views.pnp 'image' %}?{{ graph.image_url }}&graph_width=320">
                                {% endif %}
                            {% endfor %}
                        </div>

                        <div class="tab-pane" id="month">
                            {% for graph in graph_urls %}
                                {% if graph.title == "One Month" %}
                                    <img src="{% url pnp.views.pnp 'image' %}?{{ graph.image_url }}&graph_width=320">
                                {% endif %}
                            {% endfor %}
                        </div>

                        <div class="tab-pane" id="year">
                            {% for graph in graph_urls %}
                                {% if graph.title == "One Year" %}
                                    <img src="{% url pnp.views.pnp 'image' %}?{{ graph.image_url }}&graph_width=320">
                                {% endif %}
                            {% endfor %}
                        </div>


                </div>
            </div>
                {% else %}
                    No Performance data is available for this {{ my_object.object_type }}.
                {% endif %}
        </div>
    </div>
{% endblock %}

{% block header %}
    {{ block.super }}
    <style>
    .table th, .table td {
      line-height: 10px;
    }
    </style>
    <style>
        .state_0 {
            background-color: #DFF0D8;
            border-color: #D6E9C6;
        }
        .state_1 {
            background-color: #FCF8E3;
        }
        .state_2 {
            background-color: #EED3D7;
            #color: #B94A48;
        }
        .state_3 {
            background-color: #d3d3d3;
        }
        .table td {
            line-height: 10px;
        }
        #preview{
            position:absolute;
            border:1px solid #ccc;
            background:#333;
            padding:5px;
            display:none;
            color:#fff;
        }


    </style>

    <!-- This is for pnp4nagios popover functions -->
    <script src="{% url media path="pnp/js/jquery.js" %}" type="text/javascript"></script>
    <script src="{% url media path="pnp/js/main.js" %}" type="text/javascript"></script>

{% endblock %}



{% block footer %}
    {{ block.super }}
{% endblock %}
