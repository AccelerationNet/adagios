{% extends "base_status.html" %}

{% block title %}Audit Log{% endblock %}
{% block smallheader %}audit{% endblock %}
{% block largeheader %}log{% endblock %}
{% block nav1 %}misc{% endblock %}

{% block content %}
    <div >
        <pre id="command_line_preview">Loading...</pre>
    </div>
        <div id="check_command_parameters"></div>
{% endblock %}

{% block footer %}
    {{ block.super }}
    <script src="/rest/status.js"></script>
    <script src="/rest/pynag.js"></script>
    <script src="/rest/adagios.js"></script>

        <script>
        $(document).ready(function() {
            populate_parameters();
        });

        function populate_parameters() {
            my_data = {
                "host_name": "{{ host_name }}",
                "service_description": "{{ service_description }}",
                "check_command": "{{ check_command }}"
            };
            // Update check_command_parameters div with result from this rest call:
            check_command(my_data)
                    .done( function(data) {
                        // Iterate check_command_parameters and populate it with
                        // Some input fields
                        $('#command_line_preview').html( data["command_line"] );
                        input_html = '';
                        for (var i in data) {
                            if (i == 'command_line') {}
                            else {
                                input_html += '' +
                                        '<label class="control-label" for="' + i + '">' + i + '</label>' +
                                        '<div class="controls">' +
                                        '  <input class="check_command_parameter" onkeyup="preview_command_line();" type="text" class="span11" name="' + i + '" value="' + data[i] + '">' +
                                        '</div>';
                            }
                        }
                        $('#check_command_parameters').html(input_html);
                    })
                    .fail( function(data) {
                        var result = data;
                        alert("fail" + data);
                    });




        }

        function preview_command_line() {
            // whenever check_command_parameters is changed, lets update the check_command preview
            my_data = {
                "host_name": "{{ host_name }}",
                "service_description": "{{ service_description }}",
                "check_command": "{{ check_command }}"
            };
            $(".check_command_parameter").each( function() {
                var item = $(this)[0];
                my_data[item.name] = item.value;
            });
            // Update check_command_parameters div with result from this rest call:
            check_command(my_data)
                    .done( function(data) {
                        command_line = data['command_line'];
                        $('#command_line_preview').html( command_line );
                    })
                    .fail( function(data) {
                        var result = data;
                        alert("fail" + data);
                    });


        }

        </script>


{% endblock %}